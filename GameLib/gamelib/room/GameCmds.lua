require("GameLib/common/PlazaInfo")
GameCmds = {}
GameCmds.MAIN_GR_LOGON           = 150 
GameCmds.SUB_GR_LOGON_BY_NAME    = 1   
GameCmds.SUB_GR_LOGON_BY_USERID  = 2   
GameCmds.SUB_GR_LOGON_BY_VNET  = 3		

GameCmds.SUB_GR_LOGON_SUCCESS    = 50	
GameCmds.SUB_GR_LOGON_FINISH     = 51	

GameCmds.MAIN_GR_CONFIG          = 151	
GameCmds.SUB_GR_ROOM_INFO        = 1	
GameCmds.SUB_GR_SCORE_HEADER    			 = 2		
GameCmds.SUB_GR_COLUMN_INFO	    		 = 3			
GameCmds.SUB_GR_ORDER_INFO	    		 = 4			
GameCmds.SUB_GR_MEMBER_INFO	    		 = 5			
GameCmds.SUB_PREVENT_CHEAT	    		 = 6			
GameCmds.SUB_GR_SUPPORT_TRANSFER		 = 7			
GameCmds.SUB_GR_SUPPORT_REQ_CAN_SIT	 = 8				
GameCmds.SUB_GR_VOIP_INFO			 = 9		
GameCmds.SUB_GR_TABLE_INFO			=	52		

GameCmds.MAIN_GR_USER  = 152				
GameCmds.SUB_GR_BROADCAST_USER_COME	 = 1			
GameCmds.SUB_GR_BROADCAST_USER_LEFT	 = 2			
GameCmds.SUB_GR_BROADCAST_USER_STATUS = 3			
GameCmds.SUB_GR_BROADCAST_USER_SCORE	 = 4		
GameCmds.SUB_GR_MATCH_ENCASH			 = 5		
GameCmds.SUB_GR_BROADCAST_USER_FAME	 = 6				
GameCmds.SUB_GR_BROADCAST_USER_COORDINATE	 = 114		

GameCmds.SUB_GR_INVITE_USER			 = 20			
GameCmds.SUB_GR_INVITE_PHONE			 = 21		
GameCmds.SUB_GR_GLOBAL_FIND_USER		 = 22		
GameCmds.SUB_GR_REQ_SIT_TABLE		 = 50			
GameCmds.SUB_GR_REQ_LOOK_ON_TABLE	 = 51			
GameCmds.SUB_GR_REQ_STAND_UP			 = 52		
GameCmds.SUB_GR_REQ_INVITE_USER		 = 53			
GameCmds.SUB_GR_REQ_PHONE			 = 54			
GameCmds.SUB_GR_INVITE_PHONE_ANSWER	 = 55			
GameCmds.SUB_GR_GLOBAL_USER_INFO		 = 56		
GameCmds.SUB_GR_MATCH_AGREE_ENCASH	 = 57			
GameCmds.SUB_GR_TRANSFER				 = 58		
GameCmds.SUB_GR_SAFEBOX				 = 59			
GameCmds.SUB_GR_TRANSFER_RESPONSE	 = 60			
GameCmds.SUB_GR_SAFEBOX_RESPONSE		 = 61		
GameCmds.SUB_GR_GET_SAFE_GUARD		 = 62			
GameCmds.SUB_GR_GET_SAFE_GUARD_RESPONSE = 63		
GameCmds.SUB_GR_GET_CAN_USE_MONEY	 = 64			
GameCmds.SUB_GR_GET_CAN_USE_MONEY_RESPONSE = 65		
GameCmds.SUB_GR_REQ_CAN_SIT_TABLE	 = 66			
GameCmds.SUB_GR_CAN_SIT_TABLE_RESPONSE = 67			
GameCmds.SUB_GR_MANAGER_BMATCH_CUOHE_PLAYER = 68	
GameCmds.SUB_GR_REQ_VOIP				 = 69		
GameCmds.SUB_GR_CANCEL_VOIP			 = 70			
GameCmds.SUB_GR_ANSWER_VOIP			 = 71			
GameCmds.SUB_GR_READY_VOIP			 = 72			
GameCmds.SUB_GR_DROP_VOIP			 = 73			
GameCmds.SUB_GR_GLOBAL_FIND_VOIP	 = 74			
GameCmds.SUB_GR_GLORY_INFO			 = 75			
GameCmds.SUB_GR_BROADCAST_USER_FACEID = 76			
GameCmds.SUB_GR_VCODE				 = 77			
GameCmds.SUB_GR_VCODE_SEND			 = 78			
GameCmds.SUB_MGR_CANCEL_GOLDTABLE	 = 79			
GameCmds.SUB_GR_GROW_INFO  = 80				      
GameCmds.SUB_GR_BANK  = 81
GameCmds.SUB_GR_BANK_RETURN  = 82
GameCmds.SUB_GR_BANK_VALUE  = 83
GameCmds.SUB_GR_MEMBER_END_TIME  = 84
GameCmds.SUB_GR_CHANGE_PASSWORD  = 85
GameCmds.SUB_GR_CHANGE_PASSWORD_RETURN  = 86
GameCmds.SUB_GR_ARRANGE_NOT_ENOUGH_GOLD  = 87
GameCmds.SUB_GR_CLEAR_NEGATIVE  = 88
GameCmds.SUB_GR_CLEAR_ESCAPE  = 89
GameCmds.SUB_GR_ENABLE_LOOKON  = 90
GameCmds.SUB_GR_ROOM_TRANSFER  = 91
GameCmds.SUB_GR_GET_USERNAME  = 92
GameCmds.SUB_GR_VERIFYING_RECEIPT  = 93
GameCmds.SUB_GR_LOTERY_POOL  = 94
GameCmds.SUB_GR_LOTERY_PERSET  = 95
GameCmds.SUB_GR_ADD_POOL_SUCCEEDED  = 96
GameCmds.SUB_GR_TAX_VALUE  = 97
GameCmds.SUB_GR_TRANSFER_TAX_NEED  = 98
GameCmds.SUB_GR_GET_GAME_MONEY		 = 104			
GameCmds.SUB_GR_MONEY_TO_GAME		 = 105			
GameCmds.SUB_GR_FRAG_COUNT			 = 106
GameCmds.SUB_GR_QUERY_GOLD			 = 107			
GameCmds.SUB_GR_SHAKE				 = 108			
GameCmds.SUB_GR_CREATETABLE_FAILED	 = 109
GameCmds.SUB_GR_ENTERPRIVATE_FAILED	 = 110
GameCmds.SUB_GR_TOOLCARD_INFO		 = 111
GameCmds.SUB_GR_BROADCAST_USER_FAME_EX = 112		
GameCmds.SUB_GR_REQ_COORDINATE		 = 113


GameCmds.MAIN_GR_ROOM_STATUS	 = 153				--

GameCmds.SUB_GR_BROADCAST_TABLE_STATUS = 1			
GameCmds.SUB_GR_SHOW_SHORT_MESSAGE	 = 2			
GameCmds.SUB_GR_PREVETCHEAT_ROOM_TABLE_COUNT = 3	
GameCmds.SUB_GR_BROADCAST_GOLD_TABLE	 = 4		

-------------------------------------------------------
GameCmds.MAIN_GR_PROPERTY			 = 154				

GameCmds.SUB_GR_PROP_REQ_USE			 = 1			
GameCmds.SUB_GR_PROP_REQ_BUY			 = 2			
GameCmds.SUB_GR_PROP_REPLY_SUPPORT	 = 3				--
GameCmds.SUB_GR_CLIENT_PROP_USE		 = 4				--
GameCmds.SUB_GR_PROP_REQ_BUY_EX		 = 6				--
GameCmds.SUB_GR_PROP_REQ_PRESENT	 = 7				--
GameCmds.SUB_GR_PROP_REQ_THROW		 = 8				--
GameCmds.SUB_GR_PROP_REQ_BUY_V1		 = 9				--
GameCmds.SUB_GR_PROP_REQ_UPDATE		 = 10				--


GameCmds.SUB_GR_PROP_REALIZE			 = 20			
GameCmds.SUB_GR_PROP_REQ_SUPPORT		 = 21			
GameCmds.SUB_GR_PROP_UPDATE			 = 22				--
GameCmds.SUB_GR_PROP_ISSHOW_BTBUY	 = 23				--
GameCmds.SUB_GR_CLIENT_PROP_REALIZE	 = 24				--
GameCmds.SUB_GR_CLIENT_PROP_PLAY_FLASH  = 25			
GameCmds.SUB_GR_PROP_ASK_BUY			 = 26			

----------------------------------------------------------
GameCmds.MAIN_GR_CLIENT				 = 155				--

GameCmds.SUB_GR_CHAT_SUPPORT_HTML	 = 1				--
GameCmds.SUB_CR_MSG_BOX_REQ			 = 2				--
GameCmds.SUB_CR_MSG_BOX_RET			 = 3				--
GameCmds.SUB_GR_CLOST_GAME_CLIENT	 = 4				--鍏抽棴瀹㈡埛绔?
GameCmds.SUB_GR_MSG_AUTO_CLOSE		 = 5				--
GameCmds.SUB_CR_MSG_BOX_REQ_WITH_TIMER  = 6				--

GameCmds.MAIN_GR_MATCH				=	156				--比赛相关命令
GameCmds.SUB_GR_MATCH_PRIZE			=	1				-- 比赛奖励
--int nRanking,char* szPrize;
GameCmds.SUB_GR_MATCH_WAIT_START	=	2				-- 比赛因人不齐，请等待

GameCmds.SUB_GR_MATCH_ELIMINATE		=	3				-- 被淘汰
GameCmds.SUB_GR_MATCH_PROMOTE		=	4				-- 晋级

GameCmds.MAIN_GR_FRIENDTABLE		=		157					--好友桌相关协议

GameCmds.SUB_GR_CREATE_FRIENDTABLE_REQ		=	1				--创建好友桌
GameCmds.SUB_GR_CREATE_FRIENDTABLE_RSP		=	2				--创建好友桌结果
GameCmds.SUB_GR_FRIENDTABLE_DISMISS_REQ		=	3				--解散好友桌
GameCmds.SUB_GR_FRIENDTABLE_DISMISS_RSP		=	4				--解散好友桌结果
GameCmds.SUB_GR_FRIENDTABLE_NOTICE_VOTE		=	5				--发送好友桌投票通知
GameCmds.SUB_GR_FRIENDTABLE_VOTE_REQ		=	7				--解散好友桌投票
GameCmds.SUB_GR_FRIENDTABLE_VOTE_RSP		=	8				--解散好友桌投票结果
GameCmds.SUB_GR_FRIENDTABLE_END_INFO		=	9				--好友桌结束消息
GameCmds.SUB_GR_FRIENDTABLE_ADD_REQ			=	11				--加入好友桌
GameCmds.SUB_GR_FRIENDTABLE_ADD_RSP			=	12				--加入好友桌结果
GameCmds.SUB_GR_FRIENDTABLE_RULE_RSP		=	13				--好友桌规则结果
GameCmds.SUB_GR_FRIENDTABLE_ABLED			=	15				--好友桌是否已经开始

GameCmds.CMD_HTML_HALL_CHAT  = 0x1E
GameCmds.CMD_HTML_TABLE_CHAT  = 0x1F


GameCmds.CMD_AD  = 0x12
GameCmds.CMD_MANAGER  = 0x15
GameCmds.CMD_SERVER_PING  = 0x1a
GameCmds.IDS_SP_PING_CLIENT  = 1
GameCmds.IDC_SP_ANWSER_PING  = 2

GameCmds.IDS_MANAGER_MANAGER_MESSAGE  = 0x0A

GameCmds.MAIN_CM_SERVICE  = 200				--鏈嶅姟娑堟伅

GameCmds.SUB_CM_MESSAGE			 = 1				--绯荤粺娑堟伅
GameCmds.SUB_CM_MESSAGE_EX		 = 2				--鎵╁睍娑堟伅
GameCmds.SUB_CM_MESSAGE_EX_2		 = 3				--浜屾鎵╁睍娑堟伅
GameCmds.SUB_CM_SHOW_WEB			 = 4				--鏈嶅姟鍣ㄩ€氱煡鎵撳紑椤甸潰

GameCmds.SUB_CM_YESORNO_REQ		 = 11				--鏈嶅姟鍣ㄨ闂畒es or no 娑堟伅
GameCmds.SUB_CM_YESORNO_RET		 = 12				--澶у巺绛斿yes or no 娑堟伅

GameCmds.SUB_CM_MSG_BOX_REQ		 = 13				--鏈嶅姟鍣ㄨ姹傚脊鍑篗SGBOX
GameCmds.SUB_CM_MSG_BOX_RET		 = 14				--澶у巺绛斿MSGBOX娑堟伅
GameCmds.SUB_CR_MSG_BOX_REQ_TIMER = 15				--澶у巺绛斿MSGBOX娑堟伅(甯imer)
--------------------------------------------------------------------------

GameCmds.MAIN_CM_DOWN_LOAD		 = 201				--涓嬭浇娑堟伅

GameCmds.SUB_CM_DOWN_LOAD_INSTALL = 1				--瀹夎鏂囦欢

GameCmds.CMD_NONE					= 0	-- = 0鏄渶瀹规槗鍑虹幇鐨勪贡鐮侊紝涓嶈兘瀹氫箟涓哄懡浠ょ爜
GameCmds.CMD_LOGIN					 = 1
GameCmds.CMD_FTP						 = 2
GameCmds.CMD_GAME					 = 3
GameCmds.CMD_USER					 = 4
GameCmds.CMD_SQUARE					 = 5
GameCmds.CMD_HALL_CHAT				 = 6
GameCmds.CMD_TABLE_CHAT				 = 7
GameCmds.CMD_JUDGE					 = 8
GameCmds.CMD_WHISPER					 = 9
GameCmds.CMD_SERVER_INFO				 = 0x0A
GameCmds.CMD_GAME_INFO				 = 0x0B
GameCmds.CMD_USER_COUNT				 = 0x0C
GameCmds.CMD_SERVER_CLOSE			 = 0x0D
GameCmds.CMD_SQUARE_IDLE				 = 0x0E
GameCmds.CMD_SQUARE_ACTIVE			 = 0x0F
GameCmds.CMD_REPORT_EVENT			 = 0x10
GameCmds.CMD_POST_DATA				 = 0x11
GameCmds.IDC_USER_REQ_SIT_DOWN			 = 0x01
GameCmds.IDS_USER_ANS_SIT_DOWN			 = 0x02
GameCmds.IDC_USER_STAND_UP				 = 0x03
GameCmds.IDC_USER_AGREE_START			 = 0x04
GameCmds.IDC_USER_GAME_OVER				 = 0x06
GameCmds.IDC_USER_REQ_LOOK_ON			 = 0x07
GameCmds.IDS_USER_ANS_LOOK_ON			 = 0x08
GameCmds.IDS_USER_BROADCAST_USER_INFO	 = 0x09
GameCmds.IDS_USER_BROADCAST_USER_STATUS	 = 0x0A
GameCmds.IDS_USER_BROADCAST_TALBLE_STATUS = 0x0B
GameCmds.IDS_USER_BROADCAST_USER_GAMEOVER = 0x0C
GameCmds.IDC_USER_AGREE_LOOKON			 = 0x0D
GameCmds.IDS_USER_USERLIST_END  = 0x0E



-- CMD_PING_USER
GameCmds.CMD_PING_USER  = 0x16		-- 缃戠粶娴嬭瘯

GameCmds.IDC_PING_USER					 = 0X01
GameCmds.IDS_PING_USER					 = 0X02
GameCmds.IDC_ANSWER_PING				 = 0X03
GameCmds.IDS_ANSWER_PING  = 0X04
GameCmds.IDC_PING_ME							 = 0x05
GameCmds.IDS_ANSWER_PING_ME					 = 0x06

GameCmds.SUB_GR_ROOM_OPTION  = 50				--鎴块棿閰嶇疆

GameCmds.CMD_CLIENT_VERSION  = 0x81

GameCmds.IDC_USER_KICK_OFF_TABLE  = 0x12
GameCmds.KICK_ENEMY		 = 1	-- 鍥犱负鏄晫浜烘墍浠ヨ涪浠?
GameCmds.KICK_MASTER_DENY  = 2	-- 鍥犱负鎴戞槸妗屼富锛屾垜鎯宠涪浣?

GameCmds.SEND_TABLE_CHAT_OK		=		0
GameCmds.SEND_TABLE_CHAT_OFFLINE		=	1
GameCmds.SEND_TABLE_CHAT_NULL_CONTENT=	2
GameCmds.SEND_TABLE_CHAT_BUSY	=		3


-- struct ANS_LOOK_ON_SITDOWN
-- {
-- 	union RETURN_CODE
-- 	{
-- 		BYTE cbIsEnable;
-- 		DWORD dwErrorCode;
-- 	} ReturnCode;
-- 	WORD  wTable;
-- 	BYTE   cbChair;
-- };
ANS_LOOK_ON_SITDOWN = {cbIsEnable , dwErrorCode , wTable , cbChair}
ANS_LOOK_ON_SITDOWN.__index = ANS_LOOK_ON_SITDOWN

function ANS_LOOK_ON_SITDOWN:new(buffer, nLen)
	
	local self = {
		cbIsEnable = 0,
		dwErrorCode = 0,
		wTable = 0,
		cbChair = 0
	}

	setmetatable(self, ANS_LOOK_ON_SITDOWN)

	if (buffer == nil) then
		return self
	end

	local ba = require("ByteArray").new()
	ba:writeBuf(buffer)
	ba:setPos(1)

	self.dwErrorCode = ba:readUInt()
	self.cbIsEnable = self.dwErrorCode % 256
	self.wTable = ba:readShort()
	self.cbChair = ba:readByte()

	return self
end

function ANS_LOOK_ON_SITDOWN:getLen()
	return 8 + 2 + 1
end

-- struct CMD_GR_BroadCast_TableStatus
-- {
-- 	WORD					wTableID;						--妗屽瓙鍙风爜
-- 	BYTE					cbTableStatus;					--妗屽瓙鐘舵€?
-- };
CMD_GR_BroadCast_TableStatus = {wTableID , cbTableStatus}
CMD_GR_BroadCast_TableStatus.__index = CMD_GR_BroadCast_TableStatus

function CMD_GR_BroadCast_TableStatus:new(buffer, nLen)
	
	local self = {
		wTableID = 0,
		cbTableStatus = 0
	}

	setmetatable(self, CMD_GR_BroadCast_TableStatus)

	if (buffer == nil) then
		return self
	end

	local ba = require("ByteArray").new()
	ba:writeBuf(buffer)
	ba:setPos(1)

	self.wTableID = ba:readShort()
	self.cbTableStatus = ba:readByte()

	return self
end

function CMD_GR_BroadCast_TableStatus:getLen()
	return 2 + 1
end

-- struct CMD_GR_BroadCast_UserStatus
-- {
-- 	DWORD					dwUserDBID;				--鏁版嵁搴?ID
-- 	BYTE					cbUserStatus;			--鐢ㄦ埛鐘舵€?
-- 	WORD					wNetTimelag;			--缃戠粶寤舵椂
-- 	WORD					wTableID;				--妗屽瓙浣嶇疆
-- 	BYTE					cbChairID;				--妞呭瓙浣嶇疆
-- };
CMD_GR_BroadCast_UserStatus = {}
CMD_GR_BroadCast_UserStatus.__index = CMD_GR_BroadCast_UserStatus

function CMD_GR_BroadCast_UserStatus:new(buffer, nLen)

	local self = {dwUserDBID = 0 , cbUserStatus = 0 , wNetTimelag = 0 , wTableID = 0 , cbChairID = 0 }
	setmetatable(self, CMD_GR_BroadCast_UserStatus)

	if (buffer == nil) then
		return self
	end

	local ba = require("ByteArray").new()
	ba:writeBuf(buffer)
	ba:setPos(1)

	self.dwUserDBID = ba:readUInt()
	self.cbUserStatus = ba:readByte()
	self.wNetTimelag = ba:readShort()
	self.wTableID = ba:readShort()
	self.cbChairID = ba:readByte()

	return self
end

-- struct CMD_GR_BroadCast_UserCoordinate
-- {
-- 	DWORD					dwUserDBID;				
-- 	FLOAT					fLongitude;			   
-- 	FLOAT					fLatitude;
-- };
CMD_GR_BroadCast_UserCoordinate = {}
CMD_GR_BroadCast_UserCoordinate.__index = CMD_GR_BroadCast_UserCoordinate

function CMD_GR_BroadCast_UserCoordinate:new(buffer, nLen)

	local self = {dwUserDBID = 0 , fLongitude = 0 , fLongitude = 0}
	setmetatable(self, CMD_GR_BroadCast_UserCoordinate)

	if (buffer == nil) then
		return self
	end

	local ba = require("ByteArray").new()
	ba:writeBuf(buffer)
	ba:setPos(1)

	self.dwUserDBID = ba:readUInt()
	self.fLongitude = ba:readFloat()
	self.fLatitude = ba:readFloat()

	return self
end


-- struct CMD_GR_BroadCast_UserScore
-- {
-- 	DWORD					dwUserDBID;				--鏁版嵁搴?ID
-- 	BYTE					cbScoreSize;			--鍒嗘暟闀垮害
-- 	BYTE					cbScoreBuf[SCORE_BUF];	--鐢ㄦ埛鍒嗘暟
-- };
CMD_GR_BroadCast_UserScore = {}
CMD_GR_BroadCast_UserScore.__index = CMD_GR_BroadCast_UserScore

function CMD_GR_BroadCast_UserScore:new(buffer, nLen)
	
	local self = {
		dwUserDBID = 0,
		cbScoreSize = 0,
		cbScoreBuf
	}

	setmetatable(self, CMD_GR_BroadCast_UserScore)

	if (buffer == nil) then
		return self
	end

	local ba = require("ByteArray").new()
	ba:writeBuf(buffer)
	ba:setPos(1)

	self.dwUserDBID = ba:readUInt()
	self.cbScoreSize = ba:readByte()
	--cclog("CMD_GR_BroadCast_UserScore cbScoreSize = " .. self.cbScoreSize .. ",ba:len = " .. ba:getLen())
	if (self.cbScoreSize > 0) then
		--self.cbScoreBuf = ba:getBytes(ba:getPos(), self.cbScoreSize)
		self.cbScoreBuf = string.sub(buffer,ba:getPos())
	end
	return self
end

function CMD_GR_BroadCast_UserScore:getLen()
	return 2 + 1 + 32
end

-- struct CMD_GR_CanSitTable
-- {
-- 	WORD wTableIdx;	--妗屽瓙鍙?
-- 	BYTE cbChairID;	--妞呭瓙鍙?
-- 	bool bCanSite;	--鏄惁鍙互鍧愪笅
-- };
CMD_GR_CanSitTable = {}
CMD_GR_CanSitTable.__index = CMD_GR_CanSitTable

function CMD_GR_CanSitTable:new(buffer, nLen)

	local self = {
		wTableIdx = 0,
		cbChairID = 0,
		bCanSite = false
	}

	setmetatable(self, CMD_GR_CanSitTable)

	if (buffer == nil) then
		return self
	end

	local ba = require("ByteArray").new()
	ba:writeBuf(buffer)
	ba:setPos(1)

	self.wTableIdx = ba:readShort()
	self.cbChairID = ba:readByte()
	self.bCanSite = ba:readByte() ~= 0

	return self
end

function CMD_GR_CanSitTable:getLen()
	return 2 + 1 + 1
end

-- struct tagBufReserve
-- {
-- 	BYTE					cbReserveLen;			--鏁版嵁闀垮害
-- 	BYTE					Buffer[RESERVE_LEN];	--淇濈暀缂撳瓨
-- };
tagBufReserve = {}
tagBufReserve.__index = tagBufReserve

function tagBufReserve:new(buffer, nLen)
	
	local self = {
		cbReserveLen = 0,
		Buffer = {}
	}

	setmetatable(self, tagBufReserve)

	if (buffer == nil) then
		return self
	end

	local ba = require("ByteArray").new()
	ba:writeBuf(buffer)
	ba:setPos(1)


	self.cbReserveLen = ba:readByte()
	
	for i=1,self.cbReserveLen do
		self.Buffer[i] = ba:readByte()
	end

	for i=self.cbReserveLen + 1,32 do
		self.Buffer[i] = 0
	end
	

	return self
end

function tagBufReserve:getLen()
	return 1 + 32
end

-- struct CMD_GR_GameInfo
-- {
-- 	BYTE					cbGameKindID;			--娓告垙绫诲瀷
-- 	BYTE					cbEnableLookOn;			--鍏佽鏃佽
-- 	int					uServerID;				--鎴块棿鍙风爜
-- 	WORD					wTableCount;			--妗屾暟鏁扮洰
-- 	BYTE					cbTableUser;			--鐢ㄦ埛鏁扮洰
-- 	tagBufReserve			OptionsBuf;				--璁剧疆缂撳啿
-- };
CMD_GR_GameInfo = {cbGameKindID , cbEnableLookOn , uServerID , wTableCount , cbTableUser , OptionsBuf = {}}
CMD_GR_GameInfo.__index = CMD_GR_GameInfo

function CMD_GR_GameInfo:new(buffer, nLen)
	
	local self = {
		cbGameKindID = 0,
	 	cbEnableLookOn  = 0,
	 	uServerID  = 0,
	 	wTableCount  = 0,
	 	cbTableUser  = 0,
	 	OptionsBuf = tagBufReserve:new()
	}

	setmetatable(self, CMD_GR_GameInfo)

	if (buffer == nil) then
		return self
	end

	local ba = require("ByteArray").new()
	ba:writeBuf(buffer)
	ba:setPos(1)

	self.cbGameKindID = ba:readByte()
	self.cbEnableLookOn = ba:readByte()
	self.uServerID = ba:readInt()
	self.wTableCount = ba:readShort()
	self.cbTableUser = ba:readByte()

	local content = ba:getBytes(ba:getPos(), self.OptionsBuf:getLen())
	self.OptionsBuf = tagBufReserve:new(content , self.OptionsBuf:getLen())

	return self
end

function CMD_GR_GameInfo:getLen()
	return 1 + 1 + 4 + 2 + 1 + tagBufReserve:getLen()
end

-- struct CMD_GR_Logon_ByUserID
-- {
-- 	int					lUserDBID;				--鏁版嵁搴?ID
-- 	char					szPass[PASS_LEN];		--鐢ㄦ埛瀵嗙爜
-- 	tagConnectInfo			ConnectInfo;			--杩炴帴淇℃伅
-- 	tagClientInfo			ClientInfo;				--瀹㈡埛绔俊鎭?
-- 	tagVersionInfo			VersionInfo;			--鐗堟湰淇℃伅
-- };

CMD_GR_Logon_ByUserID = {lUserDBID, szPass = {}, ConnectInfo = {}, ClientInfo = {}, VersionInfo = {}}
CMD_GR_Logon_ByUserID.__index = CMD_GR_Logon_ByUserID

function CMD_GR_Logon_ByUserID:new(buffer, nLen)
	local self = {
		lUserDBID = 0,
		szPass = "szPass",
		ConnectInfo = tagConnectInfo:new(),
		ClientInfo = tagClientInfo:new(),
		VersionInfo = tagVersionInfo:new()
	}

	setmetatable(self, CMD_GR_Logon_ByUserID)

	if (buffer == nil) then
		return self
	end

	local ba = require("ByteArray").new()
	ba:writeBuf(buffer)
	ba:setPos(1)

	self.lUserDBID = ba:readInt()
	self.szPass = ba:readStringSubZero(16)
	local content = ba:getBytes(ba:getPos(), self.ConnectInfo:getLen())
	self.ConnectInfo = tagConnectInfo:new(content, self.ConnectInfo:getLen())
	ba:setPos(ba:getPos() + self.ConnectInfo:getLen())

	local content2 = ba:getBytes(ba:getPos(), self.ClientInfo:getLen())
	self.ClientInfo = tagClientInfo:new(content2, self.ClientInfo:getLen())
	ba:setPos(ba:getPos() + self.ClientInfo:getLen())

	local content3 = ba:getBytes(ba:getPos(), self.VersionInfo:getLen())
	self.VersionInfo = tagVersionInfo:new(content2, self.VersionInfo:getLen())
	ba:setPos(ba:getPos() + self.VersionInfo:getLen())

	return self
end

function CMD_GR_Logon_ByUserID:getLen()
	return 4 + 16 + self.ConnectInfo:getLen() + self.ClientInfo:getLen() + self.VersionInfo:getLen()
end

-- struct CMD_GR_Logon_ByVnet
-- {
-- 	long					lUserDBID;								--鏁版嵁搴?ID
-- 	char					szEncryptPass[64];		--鍔犲瘑瀵嗙爜
-- 	tagConnectInfo			ConnectInfo;							--杩炴帴淇℃伅
-- 	tagClientInfo			ClientInfo;								--瀹㈡埛绔俊鎭?
-- 	tagVersionInfo			VersionInfo;							--鐗堟湰淇℃伅
-- 	BYTE					cbShake;				-- 鏄惁鎽囨憞杩涘叆
-- 	BYTE					cbEnterType;	-- 进入类型：0=普通，1=创建密码房，2=加入密码房
-- 	char					szTablePass[PASS_LEN];
-- }
CMD_GR_Logon_ByVnet = {}
CMD_GR_Logon_ByVnet.__index = CMD_GR_Logon_ByVnet

function CMD_GR_Logon_ByVnet:new()
	local  self = {
		lUserDBID = 0,
		szEncryptPass = "",
		ConnectInfo = tagConnectInfo:new(),
		ClientInfo,
		VersionInfo,
		cbShake = 0,
		cbEnterType = 0,
		szTablePass = ""
	}

	setmetatable(self, CMD_GR_Logon_ByVnet)
	return self
end

function CMD_GR_Logon_ByVnet:Serialize()
	local ba = require("ByteArray").new()
	ba:writeInt(self.lUserDBID)
	self.szEncryptPass = string.sub(self.szEncryptPass,1,64)
	ba:writeString(self.szEncryptPass)
	for i=string.len(self.szEncryptPass) + 1,64 do
		ba:writeByte(0)
	end
	
	ba:writeByteArray(self.ConnectInfo:Serialize())
	ba:writeByteArray(self.ClientInfo:Serialize())
	ba:writeByteArray(self.VersionInfo:Serialize())	
	ba:writeUByte(self.cbShake and 1 or 0)
	ba:writeUByte(self.cbEnterType)
	self.szTablePass = string.sub(self.szTablePass,1,16)
	ba:writeString(self.szTablePass)
	for i=string.len(self.szTablePass) + 1,16 do
		ba:writeByte(0)
	end
	ba:setPos(1)	
	return ba
end


-- --请求坐下
-- struct CMD_GR_Req_UserSit
-- {
-- 	WORD					wNetSpeed;				--网络延时
-- 	WORD					wTableID;				--桌子号码
-- 	BYTE					cbChairID;				--桌子位置
-- 	BYTE					cbCreateTable;			--是否创建
-- 	char					szTablePass[PASS_LEN];	--桌子密码
-- 	CMD_GR_Req_UserSit()
-- 	{
-- 		memset(this,0,sizeof(CMD_GR_Req_UserSit));
-- 	}
-- };
CMD_GR_Req_UserSit = {}
CMD_GR_Req_UserSit.__index = CMD_GR_Req_UserSit
function CMD_GR_Req_UserSit:new(buffer, nLen)
	local self = {
		wNetSpeed = 0,
		wTableID = 0,
		cbChairID = 0,
		cbCreateTable = 0,
		szTablePass = "szTablePass"
	}

	setmetatable(self, CMD_GR_Req_UserSit)

	if (buffer == nil) then
		return self
	end

	local ba = require("ByteArray").new()
	ba:writeBuf(buffer)
	ba:setPos(1)

	self.wNetSpeed = ba:readShort()
	self.wTableID = ba:readShort()
	self.cbChairID = ba:readByte()
	self.cbCreateTable = ba:readByte()
	self.szTablePass = ba:readStringSubZero(16)

	return self
end

function CMD_GR_Req_UserSit:Serialize()
	self.szTablePass = self.szTablePass or ""
	local ba = require("ByteArray").new()
	ba:writeShort(self.wNetSpeed)
	ba:writeShort(self.wTableID)
	ba:writeByte(self.cbChairID)
	ba:writeByte(self.cbCreateTable)
	
	self.szTablePass = string.sub(self.szTablePass,1,15)
	ba:writeString(self.szTablePass)
	--cclog("tagClientInfo:writeString " .. self.szComputerName)
	--end
	for i=string.len(self.szTablePass) + 1,16 do
		ba:writeByte(0)
	end
	ba:setPos(1)
	return ba
end



-- struct CMD_GR_Req_UserLookOn
-- {
-- 	WORD					wNetSpeed;				--缃戠粶寤舵椂
-- 	WORD					wTableID;				--妗屽瓙鍙风爜
-- 	BYTE					cbChairID;				--妗屽瓙浣嶇疆
-- 	BYTE					cbPassLen;				--瀵嗙爜闀垮害
-- 	char					szTablePass[PASS_LEN];	--妗屽瓙瀵嗙爜
-- };
CMD_GR_Req_UserLookOn = {}
CMD_GR_Req_UserLookOn.__index = CMD_GR_Req_UserLookOn

function CMD_GR_Req_UserLookOn:new(buffer, nLen)
	local self = {
		wNetSpeed = 0,
		wTableID = 0,
		cbChairID = 0,
		cbPassLen = 0,
		szTablePass = "szTablePass"
	}

	setmetatable(self, CMD_GR_Req_UserLookOn)

	if (buffer == nil) then
		return self
	end

	local ba = require("ByteArray").new()
	ba:writeBuf(buffer)
	ba:setPos(1)

	self.wNetSpeed = ba:readShort()
	self.wTableID = ba:readShort()
	self.cbChairID = ba:readByte()
	self.cbPassLen = ba:readByte()
	if (self.cbPassLen > 0)	then
		self.szTablePass = ba:readStringSubZero(self.cbPassLen)
	end

	for i=self.szTablePass,16 do
		self.szTablePass[i] = 0
	end

	return self
end

function CMD_GR_Req_UserLookOn:Serialize()
	local ba = require("ByteArray").new()
	ba:writeShort(self.wNetSpeed)
	ba:writeShort(self.wTableID)
	ba:writeByte(self.cbChairID)
	ba:writeByte(self.cbPassLen)
	if(self.cbPassLen > 0) then
		ba:writeString(self.szTablePass)
	else
		for i=1,16 do
			ba:writeByte(0)
		end
	end
	ba:setPos(1)
	return ba
end

-- struct CMD_GR_RoomOption
-- {
-- 	int					lMinScore;					--闄愬埗鏈€浣庡垎鏁?
-- 	int					lMaxScore;					--闄愬埗鏈€楂樺垎鏁?
-- 	WORD					wNetTimelag;			--鏈€楂樼綉缁滃欢鏃?
-- 	WORD					wEscape;				--闄愬埗閫冭窇鐜?
-- 	BYTE					cbIPLimmit;				--闄愬埗鍚屼竴IP
-- }
CMD_GR_RoomOption = {}
CMD_GR_RoomOption.__index = CMD_GR_RoomOption
function CMD_GR_RoomOption:new(buffer, nLen)
	local self = {
		lMinScore = -2147483647,
		lMaxScore = 2147483647,
		wNetTimelag = 0xFFFF,
		wEscape = 0xFFFF,
		cbIPLimmit = 0
	}

	setmetatable(self, CMD_GR_RoomOption)
	return self
end

function CMD_GR_RoomOption:Serialize()
	local ba = require("ByteArray").new()
	ba:writeInt(self.lMinScore)
	ba:writeInt(self.lMaxScore)
	ba:writeShort(self.wNetTimelag)
	ba:writeShort(self.wEscape)
	ba:writeByte(self.cbIPLimmit)
	return ba
end



-- enum enFieldType
-- {
-- 	FIELD_DATA_ID,					--鏁版嵁搴?ID
-- 	FIELD_USER_INDEX,				--鐢ㄦ埛绱㈠紩
-- 	FIELD_ROUND_COUNT,				--寰幆璁℃暟
-- 	FIELD_NAME,						--鐢ㄦ埛鍚嶅瓧
-- 	FIELD_USER_DESCRIBE,			--鐢ㄦ埛鎻忚堪
-- 	FIELD_USER_NOTE,				--鐢ㄦ埛澶囨敞
-- 	FIELD_ORDER,					--鐢ㄦ埛绛夌骇
-- 	FIELD_GOLD,						--鐢ㄦ埛閲戝竵
-- 	FIELD_POINT,					--鐢ㄦ埛鍒嗘暟
-- 	FIELD_TABLE_ID,					--娓告垙妗屽彿
-- 	FIELD_CHAIR_ID,					--妞呭瓙鍙风爜
-- 	FIELD_USER_STATUS,				--鐢ㄦ埛鐘舵€?
-- 	FIELD_WIN_COUNT,				--鑳滃埄鏁扮洰
-- 	FIELD_LOST_COUNT,				--杈撴暟鐩?
-- 	FIELD_DRAW_COUNT,				--鍜屾暟鐩?
-- 	FIELD_FLEE_COUNT,				--閫冭窇鏁扮洰
-- 	FIELD_FLEE_RATE,				--閫冭窇鐜?
-- 	FIELD_WIN_RATE,					--鑳滃埄鐜?
-- 	FIELD_PLAY_COUNT,				--娓告垙灞€鏁?
-- 	FIELD_NET_TIMELAG,				--缃戠粶寤舵椂
-- 	FIELD_MEMBER,					--浼氬憳绛夌骇
-- 	FIELD_USER_LEVEL,				--鐢ㄦ埛鏉冮檺
-- 	FIELD_GROUP_ID,					--绀惧洟 ID
-- 	FIELD_GROUP_NAME,				--绀惧洟鍚嶅瓧
-- 	FIELD_OFFICE_NAME,				--绀惧洟鑱屼綅
-- 	FIELD_CONNECTION,				--鍙嬪ソ鍏崇郴
-- 	FIELD_USER_SEX,					--鐢ㄦ埛鎬у埆
-- 	FIELD_PROVINCE,					--鐢ㄦ埛鐪佷唤
-- 	FIELD_CITY,						--鐢ㄦ埛鍩庡競
-- 	FIELD_AREA,						--鐢ㄦ埛鍦板尯
-- 	FIELD_AVATARURL,				--澶村儚鍦板潃
-- 	FIELD_AGE,						--澶村儚骞撮緞
-- 	FIELD_AVATAR_NC,				--AVARTAR NC
-- 	FIELD_HAVE_MOBILE,				--鏄惁鏈夋墜鏈?
-- 	FIELD_HAVE_PHONECHAT,			--鍏ㄨ兘鑱婃爣蹇?
-- 	FIELD_PHONE_NUM,				--鍏ㄨ兘鑱婂彿鐮?

-- 	FIELD_SPECIAL_FLAG,				--鐗规畩鏍囧織鍒?
-- 	FIELD_SPECIAL_GRADE_NAME,		--鐗规畩绾у埆
-- 	FIELD_USER_LOGO,				--鐢ㄦ埛澶村儚

-- 	FIELD_GLORY_SCORE,				--鑽ｈ獕鍒嗘暟
-- 	FIELD_GLORY_INFO,				--鑽ｈ獕淇℃伅

-- 	FIELD_MEMBER_SCORE,				--浼氬憳鎴愰暱鍊?			add by mxs ms
-- 	FITLE_MEMBER_CLASS,				--浼氬憳绾у埆(缁嗗垎绾у埆)		add by mxs ms
-- 	FITLE_FAME,				-- 澹版湜
-- 	FIELD_QQ,
-- 	FIELD_LOCATION,
-- 	FIELD_FACECHANGEINDEX,
-- };
enFieldType = {}
enFieldType.FIELD_DATA_ID = 0
enFieldType.FIELD_USER_INDEX = 1				
enFieldType.FIELD_ROUND_COUNT = 2				
enFieldType.FIELD_NAME = 3			
enFieldType.FIELD_USER_DESCRIBE = 4	
enFieldType.FIELD_USER_NOTE = 5				
enFieldType.FIELD_ORDER	= 6			
enFieldType.FIELD_GOLD = 7				
enFieldType.FIELD_POINT	=8				
enFieldType.FIELD_TABLE_ID = 9
enFieldType.FIELD_CHAIR_ID = 10				
enFieldType.FIELD_USER_STATUS = 11
enFieldType.FIELD_WIN_COUNT = 12
enFieldType.FIELD_LOST_COUNT = 13
enFieldType.FIELD_DRAW_COUNT = 14
enFieldType.FIELD_FLEE_COUNT = 15
enFieldType.FIELD_FLEE_RATE = 16
enFieldType.FIELD_WIN_RATE = 17
enFieldType.FIELD_PLAY_COUNT = 18
enFieldType.FIELD_NET_TIMELAG = 19
enFieldType.FIELD_MEMBER = 20
enFieldType.FIELD_USER_LEVEL = 21
enFieldType.FIELD_GROUP_ID = 22
enFieldType.FIELD_GROUP_NAME = 23
enFieldType.FIELD_OFFICE_NAME = 24
enFieldType.FIELD_CONNECTION = 25
enFieldType.FIELD_USER_SEX = 26
enFieldType.FIELD_PROVINCE = 27
enFieldType.FIELD_CITY = 28
enFieldType.FIELD_AREA = 29
enFieldType.FIELD_AVATARURL = 30
enFieldType.FIELD_AGE = 31
enFieldType.FIELD_AVATAR_NC = 32
enFieldType.FIELD_HAVE_MOBILE = 33
enFieldType.FIELD_HAVE_PHONECHAT = 34
enFieldType.FIELD_PHONE_NUM = 35
enFieldType.FIELD_SPECIAL_FLAG = 36
enFieldType.FIELD_SPECIAL_GRADE_NAME = 37
enFieldType.FIELD_USER_LOGO = 38
enFieldType.FIELD_GLORY_SCORE = 39
enFieldType.FIELD_GLORY_INFO = 40
enFieldType.FIELD_MEMBER_SCORE = 41
enFieldType.FITLE_MEMBER_CLASS = 42
enFieldType.FITLE_FAME = 43
enFieldType.FIELD_QQ = 44
enFieldType.FIELD_LOCATION = 45
enFieldType.FIELD_FACECHANGEINDEX = 46


-- struct tagUserBasicInfoBroad
-- {
-- 	WORD					wSize;					--缁撴瀯澶у皬2
-- 	int						lUserDBID;				--鏁版嵁搴?ID6
-- 	WORD					wUserIndex;				--娓告垙绱㈠紩
-- 	WORD					wRoundCount;			--寰幆璁版暟
-- 	WORD					wFaceID;				--澶村儚 ID
-- 	WORD					wNetTimelag;			--缃戠粶寤舵椂
-- 	WORD					wTableID;				--妗屽瓙鍙风爜16
-- 	DWORD					dwGroupID;				--绀惧洟 ID
-- 	DWORD					dwUserLevel;			--鐢ㄦ埛鏉冮檺24
-- 	BYTE					cbChairID;				--妞呭瓙浣嶇疆
-- 	BYTE					cbUserStatus;			--鐢ㄦ埛鐘舵€?
-- 	BYTE					cbSex;					--鐢ㄦ埛鎬у埆
-- };
tagUserBasicInfoBroad = {}
tagUserBasicInfoBroad.__index = tagUserBasicInfoBroad
function tagUserBasicInfoBroad:new(buffer, nLen)
	local self = {
		wSize = 0,
		lUserDBID = 0,
		wUserIndex = 0,
		wRoundCount = 0,
		wFaceID = 0,
		wNetTimelag = 0,
		wTableID = 0,
		dwGroupID = 0,
		dwUserLevel = 0,
		cbChairID = 0,
		cbUserStatus = 0,
		cbSex = 0
	}

	setmetatable(self, tagUserBasicInfoBroad)

	if (buffer == nil) then
		return self
	end

	local ba = require("ByteArray").new()
	ba:writeBuf(buffer)
	ba:setPos(1)

	self.wSize = ba:readShort()
	self.lUserDBID = ba:readInt()
	self.wUserIndex = ba:readShort()
	self.wRoundCount = ba:readShort()
	self.wFaceID = ba:readShort()
	self.wNetTimelag = ba:readShort()
	self.wTableID = ba:readShort()
	self.dwGroupID = ba:readUInt()
	self.dwUserLevel = ba:readUInt()
	self.cbChairID = ba:readByte()
	self.cbUserStatus = ba:readByte()
	self.cbSex = ba:readByte()

	return self
end

function tagUserBasicInfoBroad:getLen()
	return 2 + 4 + 2 + 2 + 2 + 2 + 2 + 4 + 4 + 1 + 1 + 1
end


-- struct tagUserInfoBroadCG : tagUserBasicInfoBroad
-- {
-- 	BYTE					cbMember;				--浼氬憳绛夌骇
-- 	BYTE					cbNameLen;				--鍚嶅瓧闀垮害
-- 	BYTE					cbGroupLen;				--绀惧洟闀垮害
-- 	BYTE					cbVIPLevel;			--鑱屼綅闀垮害
-- 	BYTE					cbScoreLen;				--鍒嗘暟闀垮害32
-- };
tagUserInfoBroadCG = {UserBasicInfoBroad = {}, cbMember , cbNameLen , cbGroupLen , cbVIPLevel , cbScoreLen}
tagUserInfoBroadCG.__index = tagUserInfoBroadCG
function tagUserInfoBroadCG:new(buffer, nLen)
	local self = {
		UserBasicInfoBroad = tagUserBasicInfoBroad:new(),
		cbMember = 0,
		cbNameLen = 0,
		cbGroupLen = 0,
		cbVIPLevel = 0,
		cbScoreLen = 0
	}

	setmetatable(self, tagUserInfoBroadCG)

	if (buffer == nil) then
		return self
	end

	local ba = require("ByteArray").new()
	ba:writeBuf(buffer)
	ba:setPos(1)

	self.UserBasicInfoBroad = tagUserBasicInfoBroad:new(buffer, nLen)
	ba:setPos(self.UserBasicInfoBroad:getLen())
	self.cbMember = ba:readByte()
	self.cbNameLen = ba:readByte()
	self.cbGroupLen = ba:readByte()
	self.cbVIPLevel = ba:readByte()
	self.cbScoreLen = ba:readByte()

	return self
end

function tagUserInfoBroadCG:getLen()
	return self.UserBasicInfoBroad:getLen() + 1 + 1 + 1 + 1 + 1
end

-- struct tagUserInfoBroadYueDong : tagUserBasicInfoBroad
-- {
-- 	BYTE					cbNameLen;				--鍚嶅瓧闀垮害
-- 	BYTE					cbGroupLen;				--绀惧洟闀垮害
-- 	BYTE					cbVIPLevel;				--鑱屼綅闀垮害
-- 	BYTE					cbScoreLen;				--鍒嗘暟闀垮害32
-- 	DWORD					dwMemberClass;			--浼氬憳绛夌骇
-- 	DWORD					dwMemberLevel;
-- 	DWORD					dwFame;
-- 	DWORD					dwFameLevel;
-- 	WORD					wShowID;
-- }
tagUserInfoBroadYueDong = {}
tagUserInfoBroadYueDong.__index = tagUserInfoBroadYueDong
function tagUserInfoBroadYueDong:new(buffer, nLen)
	local self = {
		UserBasicInfoBroad = tagUserBasicInfoBroad:new(),
		cbNameLen = 0,
		cbGroupLen = 0,
		cbVIPLevel = 0,
		cbScoreLen = 0,
		dwMemberClass = 0,
		dwMemberLevel = 0,
		dwFame = 0,
		dwFameLevel = 0,
		wShowID = 0
	}

	setmetatable(self, tagUserInfoBroadYueDong)

	if (buffer == nil) then
		return self
	end

	local ba = require("ByteArray").new()
	ba:writeBuf(buffer)
	ba:setPos(1)

	self.UserBasicInfoBroad = tagUserBasicInfoBroad:new(buffer, nLen)
	ba:setPos(self.UserBasicInfoBroad:getLen())
	self.cbNameLen = ba:readByte()
	self.cbGroupLen = ba:readByte()
	self.cbVIPLevel = ba:readByte()
	self.cbScoreLen = ba:readByte()
	self.dwMemberClass = ba:readUInt()
	self.dwMemberLevel = ba:readUInt()
	self.dwFame = ba:readUInt()
	self.dwFameLevel = ba:readUInt()
	self.wShowID = ba:readShort()

	return self
end

function tagUserInfoBroadYueDong:getLen()
	return self.UserBasicInfoBroad:getLen() + 1 + 1 + 1 + 1 + 4 + 4 + 4 + 4 + 2
end

-- struct tagUserInfoBroad : tagUserInfoBroadYueDong
-- {
-- 	BYTE cbMember;
-- 	-- 鎵╁睍淇℃伅
-- 	char szName[NAME_LEN];              --鍚嶅瓧
-- 	char szGroup[GROUP_LEN];             --绀惧洟
-- 	char szScores[SCORE_BUF];            -- 鍒嗘暟buffer
-- 	--String szFields;            -- 鏄剧ず鍒?
-- 	char szAvatar[AVATAR_URL];
-- 	char szProvince[PROVINCE_LEN];
-- 	char szArea[AREA_LEN];
-- 	char szCity[CITY_LEN];
-- 	int nAge;
-- 	-- 鑽ｈ獕淇℃伅
-- 	int lGloryScore;								--鑽ｈ獕鍒嗘暟(榄呭姏鍊?
-- 	int wGloryID;									--鑽ｈ獕ID
-- 	int cbGloryLevel;								--鑽ｈ獕绾у埆
-- 	int dwSpecialFlag;								--鑽ｈ獕鏍囪嚧
-- 	int dwUpgradeDays;								--鍗囩骇澶╂暟
-- 	int dwUpgradeRemainDays;							--鍗囩骇鍓╀綑澶╂暟
-- 	int cbShowFaceOnTable;							--鍦ㄦ瀛愪笂鏄剧ず鐗规畩鏍囧織

-- 	BYTE cbFaceChangeIndex;

-- 	char szDescribe[DESCRIBE_LEN];
-- }
tagUserInfoBroad = {}
tagUserInfoBroad.__index = tagUserInfoBroad
function tagUserInfoBroad:new(buffer, nLen)
	local self = {
		wSize = 0,
		lUserDBID = 0,
		wUserIndex = 0,
		wRoundCount = 0,
		wFaceID = 0,
		wNetTimelag = 0,
		wTableID = 0,
		dwGroupID = 0,
		dwUserLevel = 0,
		cbChairID = 0,
		cbUserStatus = 0,
		cbSex = 0,
		cbNameLen = 0,
		cbGroupLen = 0,
		cbIpLen = 0,
		cbVIPLevel = 0,
		cbScoreLen = 0,
		dwMemberClass = 0,
		dwMemberLevel = 0,
		dwFame = 0,
		dwFameLevel = 0,
		wShowID = 0,
		cbMember = 0,
		szName = "szName",
		szGroup = "szGroup",
		cbUserIP = "127.0.0.1",
		szScores = "szScores",
		szAvatar = "szAvatar",
		szProvince = "szProvince",
		szArea = "szArea",
		szCity = "szCity",
		nAge = 0,
		lGloryScore = 0,
		wGloryID = 0,
		cbGloryLevel = 0,
		dwSpecialFlag = 0,
		dwUpgradeDays = 0,
		dwUpgradeRemainDays = 0,
		cbShowFaceOnTable = 0,
		cbFaceChangeIndex = 0,
        fLongitude = 0,
        fLatitude = 0,
		szDescribe = ""
	}
	setmetatable(self, tagUserInfoBroad)
	return self
end

function tagUserInfoBroad:Deserialize(buf,len)
	cclog("onSubUserComeMessage len = " .. len .. ",type = " .. type(buf))
	local ba = require("ByteArray").new()
	ba:initBuf(buf)
	self.wSize = ba:readShort()
	self.lUserDBID = ba:readInt()
	self.wUserIndex = ba:readShort()
	self.wRoundCount = ba:readShort()
	self.wFaceID = ba:readShort()
	self.wNetTimelag = ba:readShort()
	self.wTableID = ba:readShort()
	self.dwGroupID = ba:readUInt()
	self.dwUserLevel = ba:readUInt()
	self.cbChairID = ba:readByte()
	self.cbUserStatus = ba:readByte()
	self.cbSex = ba:readByte()
	self.cbNameLen = ba:readByte()
	self.cbGroupLen = ba:readByte()
	self.cbIpLen = ba:readByte()
	self.cbVIPLevel = ba:readByte()
	self.cbScoreLen = ba:readByte()
	self.dwMemberClass = ba:readUInt()
	self.dwMemberLevel = ba:readUInt()
	self.dwFame = ba:readUInt()
	self.dwFameLevel = ba:readUInt()
	self.wShowID = ba:readShort()

	if (self.cbNameLen < gamelibcommon.NAME_LEN) then		
		self.szName = ba:readStringSubZero(self.cbNameLen)
	else
		return false
	end

	if(ba:getPos() > len) then return false end

	if (self.cbGroupLen < gamelibcommon.GROUP_LEN) then
		self.szGroup = ba:readStringSubZero(self.cbGroupLen)
	else
		return false
	end

	if(ba:getPos() > len) then return false end

	if (self.cbIpLen < gamelibcommon.GROUP_LEN) then
		self.cbUserIP = ba:readStringSubZero(self.cbIpLen)
	else
		return false
	end

	if(ba:getPos() > len) then return false end

	if (self.cbScoreLen < gamelibcommon.SCORE_BUF) then
		self.szScores = ba:readString(self.cbScoreLen)
	else
		return false
	end
    
	self.fLongitude = ba:readFloat()
	self.fLatitude = ba:readFloat()

	if(ba:getPos() > len) then return false end
	
	local nFieldsLen = len - ba:getPos() + 1
	if(nFieldsLen <= 0) then return true end
	
	
	local szFields = ba:readString(nFieldsLen)

	local nFieldOff = 0
	while nFieldOff < nFieldsLen do
		local cbFdType = string.byte(string.sub(szFields,nFieldOff + 1))        
		nFieldOff = nFieldOff + 1
		local cbFdLen = string.byte(string.sub(szFields,nFieldOff + 1))
		nFieldOff = nFieldOff + 1
		if(cbFdLen > 2) then			
			cbFdLen  = cbFdLen - 2            
			if(cbFdLen + nFieldOff > nFieldsLen) then
				break
			end

			local fdData = string.sub(szFields,nFieldOff + 1,nFieldOff + 1 +cbFdLen)
			nFieldOff  = nFieldOff + cbFdLen

			if cbFdType == enFieldType.FIELD_FACECHANGEINDEX then
				self.cbFaceChangeIndex = string.byte(fdData)				
			end
			if cbFdType == enFieldType.FIELD_PROVINCE then		
				self.szProvince = fdData
			end
			if cbFdType == enFieldType.FIELD_CITY then			
				self.szCity = fdData
			end
			if cbFdType == enFieldType.FIELD_USER_DESCRIBE then
				self.szDescribe = fdData
			end
			if cbFdType == enFieldType.FIELD_AREA then
				self.szArea = fdData
			end
			if cbFdType == enFieldType.FIELD_AGE then				
				nAge = string.byte(fdData)
			end
		end
	end

	return true
end



-- struct CMD_CM_SysteMessage
-- {
-- 	BYTE			bCloseLine;						--鍏抽棴杩炴帴
-- 	BYTE			bMessageType;					--娑堟伅绫诲瀷
-- 	WORD			wMessageLen;					--娑堟伅闀垮害
-- 	char			szMessage[1024];		--娑堟伅瀛楃
-- };
CMD_CM_SysteMessage = {bCloseLine , bMessageType , wMessageLen , szMessage = {}}
CMD_CM_SysteMessage.__index = CMD_CM_SysteMessage
function CMD_CM_SysteMessage:new(buffer, nLen)
	local self = {
		bCloseLine = 0,
		bMessageType = 0,
		wMessageLen = 0,
		szMessage = ""
	}

	setmetatable(self, CMD_CM_SysteMessage)

	if (buffer == nil) then
		return self
	end

	local ba = require("ByteArray").new()
	ba:writeBuf(buffer)
	ba:setPos(1)

	self.bCloseLine = ba:readByte()
	self.bMessageType = ba:readByte()
	self.wMessageLen = ba:readShort()
	if (self.wMessageLen > 0) then
		self.szMessage = ba:readString(self.wMessageLen)
	end
	return self
end

function CMD_CM_SysteMessage:getLen()
	return 1 + 1 + 2 + 1024
end

-- struct CMD_CM_SysteMessageEx
-- {
-- 	BYTE			bCloseLine;						--鍏抽棴杩炴帴
-- 	int				uButtonType;					--鎸夐挳绫诲瀷
-- 	WORD			wMessageLen;					--娑堟伅闀垮害
-- 	char			szMessage[1024];		--娑堟伅瀛楃
-- };

CMD_CM_SysteMessageEx = {bCloseLine , uButtonType , wMessageLen , szMessage = {}}
CMD_CM_SysteMessageEx.__index = CMD_CM_SysteMessageEx
function CMD_CM_SysteMessageEx:new(buffer, nLen)
	local self = {
		bCloseLine = 0,
		uButtonType = 0,
		wMessageLen = 0,
		szMessage = "szMessage"
	}

	setmetatable(self, CMD_CM_SysteMessageEx)

	if (buffer == nil) then
		return self
	end

	local ba = require("ByteArray").new()
	ba:writeBuf(buffer)
	ba:setPos(1)

	self.bCloseLine = ba:readByte()
	self.uButtonType = ba:readByte()
	self.wMessageLen = ba:readShort()
	if (self.wMessageLen > 0) then
		self.szMessage = ba:readStringSubZero(self.wMessageLen)
	end

	for i=self.wMessageLen + 1,1024 do
		self.szMessage[i] = 0
	end

	return self
end

function CMD_CM_SysteMessageEx:getLen()
	return 1 + 1 + 2 + 1024
end

-- struct CMD_GR_GetGameMoney
-- {
-- 	CMD_GR_GetGameMoney()
-- 	{
-- 		memset(this,0,sizeof(CMD_GR_GetGameMoney));
-- 	}
-- 	long lAllMoney;
-- 	long lGameMoney;
-- 	DWORD dwReserve;
-- };
CMD_GR_GetGameMoney = {lAllMoney , lGameMoney , dwReserve}
CMD_GR_GetGameMoney.__index = CMD_GR_GetGameMoney

function CMD_GR_GetGameMoney:new(buffer, nLen)
	local self = {
		lAllMoney = 0,
		lGameMoney = 0,
		dwReserve = 0
	}

	setmetatable(self, CMD_GR_GetGameMoney)

	if (buffer == nil) then
		return self
	end

	local ba = require("ByteArray").new()
	ba:writeBuf(buffer)
	ba:setPos(1)

	self.lAllMoney = ba:readUInt()
	self.lGameMoney = ba:readUInt()
	self.dwReserve = ba:readUInt()

	return self
end

function CMD_GR_GetGameMoney:getLen()
	return 4 + 4 + 4
end

-- struct CMD_GR_MoneyToGame
-- {
-- 	CMD_GR_MoneyToGame()
-- 	{
-- 		memset(this,0,sizeof(CMD_GR_MoneyToGame));
-- 	}
-- 	BYTE cbType;
-- 	long lAmount;
-- 	DWORD dwReserve;
-- 	char szMsg[MAX_SYSTEM_MSG];
-- };
CMD_GR_MoneyToGame = {cbType , lAmount , dwReserve , szMsg = {}}
CMD_GR_MoneyToGame.__index = CMD_GR_MoneyToGame

function CMD_GR_MoneyToGame:new(buffer, nLen)
	local self = {
		cbType = 0,
		lAmount = 0,
		dwReserve = 0,
		szMsg = "szMsg"
	}

	setmetatable(self, CMD_GR_MoneyToGame)

	if (buffer == nil) then
		return self
	end

	local ba = require("ByteArray").new()
	ba:writeBuf(buffer)
	ba:setPos(1)

	self.cbType = ba:readByte()
	self.lAmount = ba:readUInt()
	self.dwReserve = ba:readUInt()
	self.szMsg = ba:readStringSubZero(1024)

	return self
end

function CMD_GR_MoneyToGame:getLen()
	return 1 + 4 + 4 + 1024
end


--[[enum BANK_OPERATION
{
	enWithawal = 0,	// 取
	enDeposit,		// 存
	enCheck,		// 检查
};
struct SBankOperation
{
	SBankOperation()
	{
		memset(this,0,sizeof(SBankOperation));
	}
	int cbFrom;
	int cbOperation;
	int nGold;
	DWORD dwReserved;
	char szPsw[32];
};]]

SBankOperation = {}
SBankOperation.__index = SBankOperation

function SBankOperation:new()
	local self = {
		cbFrom = 0,
		cbOperation = 0,
		nGold = 0,
		dwReserved = 0,
		szPsw = ""
	}

	setmetatable(self, SBankOperation)	
	return self
end

function SBankOperation:Serialize()
	local ba = require("ByteArray").new()
	ba:writeInt(self.cbFrom)
	ba:writeInt(self.cbOperation)
	ba:writeInt(self.nGold)
	ba:writeInt(self.dwReserved)
	ba:writeString(self.szPsw)
	for i=string.len(self.szPsw) + 1,32 do
		ba:writeByte(0)
	end
	ba:setPos(1)
	return ba
end

function SBankOperation:getLen()
	return 48
end
